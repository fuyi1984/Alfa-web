$(function(){gtoken=ReadCookie("token");if(gtoken!=""){setCurrentUser();$("#configadd").window("close");$("#configupdate").window("close");$("#configsearch").window("close");initdatagrid()}else{window.location.href=platform_url+"/pages/home/login.html"}});function initdatagrid(){$("#configgrid").datagrid({title:"系统配置 ",singleSelect:false,iconCls:"icon-save",collapsible:true,nowrap:false,striped:true,loader:a,sortName:"createdDt",sortOrder:"desc",remoteSort:true,fitColumns:true,fit:true,toolbar:["-",{id:"btnSave",text:"添加",iconCls:"icon-add",handler:function(){$("#configadd").window("open")}},"-",{id:"btnUpdate",text:"修改",iconCls:"icon-save",handler:function(){var b=$("#configgrid").datagrid("getSelections");if(!b||b.length==0){$.messager.alert("提示","请选择要修改的数据");return}else{if(b.length>1){$.messager.alert("提示","请选择一条数据");$("#configgrid").datagrid("clearSelections");return}else{$("#form2").form("load",{Id_update:b[0].id,configName_update:b[0].configName,configKey_update:b[0].configKey,configValue_update:b[0].configValue,description_update:b[0].description});$("#configupdate").window("open")}}}},"-",{id:"btnDelete",text:"删除",disabled:false,iconCls:"icon-cut",handler:function(){var c=$("#configgrid").datagrid("getSelections");if(!c||c.length==0){$.messager.alert("提示","请选择要删除的数据");return}var b=new Array();$.each(c,function(d,e){b.push(e.id)});$.messager.confirm("提示","是否删除这些数据?",function(d){if(!d){return}$.ajax({cache:false,datatype:"json",contentType:"application/json;charset=UTF-8",type:"POST",url:ws_url+"/rest/Sysconfig/batchdeleteConfig?token="+gtoken,data:JSON.stringify(b),success:function(e){if(e.status=="success"){$.messager.alert("提示","删除成功！","info",function(){$("#configgrid").datagrid("clearSelections");$("#configgrid").datagrid("reload")})}else{$.messager.alert("错误","删除失败！","error",function(){$("#configgrid").datagrid("clearSelections");$("#configgrid").datagrid("reload")})}},error:function(e){console.log(e);$("#configgrid").datagrid("clearSelections");$.messager.alert("错误","删除失败！","error")}})})}},"-",{id:"btnSearch",text:"查询",disabled:false,iconCls:"icon-search",handler:function(){$("#configsearch").window("open")}},"-"],idField:"Id",frozenColumns:[[{field:"Id",checkbox:true}]],columns:[[{field:"configName",title:"配置项名称",width:80,align:"center"},{field:"configKey",title:" 配置项代码",width:80,align:"center"},{field:"configValue",title:" 配置项值",width:80,align:"center"},{field:"description",title:" 配置项描述",width:80,align:"center"},{field:"createdBy",title:"创建人",width:80,align:"center"},{field:"createdDt",title:"创建时间",width:100,align:"center"},{field:"updatedBy",title:"更新人",width:80,align:"center"},{field:"updatedDt",title:"更新时间",width:100,align:"center",}]],pagination:true,rownumbers:true});function a(g,f,c){console.log(g);var b=g.page-1;var d=g.rows;var e=g.page==1?0:g.rows*(g.page-1);var h=g.rows*g.page;$.ajax({url:ws_url+"/rest/Sysconfig/findlist?token="+gtoken,type:"post",data:"filterscount=0&groupscount=0&pagenum="+b+"&pagesize="+d+"&recordstartindex="+e+"&recordendindex="+h+"&configName="+$("#configName_search").val()+"&configKey="+$("#configKey_search").val()+"",contentType:"application/json;charset=UTF-8",success:function(i){console.log(i);$("#configgrid").datagrid("clearSelections");$("#form3").form("clear");f(i)},error:function(i){console.log(i);c(i.responseText)}})}};