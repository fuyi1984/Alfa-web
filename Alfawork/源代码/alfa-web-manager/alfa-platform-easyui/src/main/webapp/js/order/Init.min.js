function echo(c,b){var a="你好";alert("hello world")}$(function(){gtoken=ReadCookie("token");if(gtoken!=""){setCurrentUser();$("#orderadd").window("close");$("#orderAllocating").window("close");initdatagrid();initcombobox();Accesscontrol()}else{window.location.href=platform_url+"/pages/home/login.html"}});function initdatagrid(){$("#ordergrid").datagrid({title:"废油回收",singleSelect:false,iconCls:"icon-save",collapsible:true,nowrap:false,striped:true,loader:a,sortName:"createdDt",sortOrder:"desc",remoteSort:true,fitColumns:true,fit:true,toolbar:["-",{id:"btnSave",text:"添加",iconCls:"icon-add",handler:function(){if(groleid==10){$("#form1").form("load",{username_add:grealname,iphone_add:gphone,address_add:gaddress,orgname_add:gorgname,});$("#username_add").textbox("textbox").attr("readonly",true);$("#iphone_add").textbox("textbox").attr("readonly",true);$("#address_add").textbox("textbox").attr("readonly",true);$("#orgname_add").textbox("textbox").attr("readonly",true)}$("#orderadd").window("open")}},"-",{id:"btnAllocating",text:"分配",iconCls:"icon-save",handler:function(){var d=$("#ordergrid").datagrid("getSelections");if(!d||d.length==0){$.messager.alert("提示","请选择需要分配的订单");return}else{var c="";for(var b=0;b<d.length;b++){if(b==0){c+=d[b].orderid}else{c+=","+d[b].orderid}}$("#workerlist").combobox({reload:ws_url+"/rest/user/findAllTransporter?token="+gtoken});$("#form2").form("load",{orderid_allocating:c});$("#orderAllocating").window("open")}}},"-",{id:"btnDelete",text:"删除",disabled:false,iconCls:"icon-cut",handler:function(){var c=$("#ordergrid").datagrid("getSelections");if(!c||c.length==0){$.messager.alert("提示","请选择需要删除的订单");return}var b=new Array();$.each(c,function(d,e){b.push(e.orderid)});$.messager.confirm("提示","是否删除这些订单?",function(d){if(!d){return}$.ajax({cache:false,datatype:"json",contentType:"application/json;charset=UTF-8",type:"POST",url:ws_url+"/rest/order/batchdeleteorders?token="+gtoken,data:JSON.stringify(b),success:function(e){if(e.status=="success"){$.messager.alert("提示","删除成功！","info",function(){$("#ordergrid").datagrid("clearSelections");$("#ordergrid").datagrid("reload")})}else{$.messager.alert("错误","删除失败！","error",function(){$("#ordergrid").datagrid("clearSelections");$("#ordergrid").datagrid("reload")})}},error:function(e){console.log(e);$("#ordergrid").datagrid("clearSelections");$.messager.alert("错误","删除失败！","error")}})})}},"-",{id:"btnConfirm",text:"确认",disabled:false,iconCls:"icon-save",handler:function(){var c=$("#ordergrid").datagrid("getSelections");if(!c||c.length==0){$.messager.alert("提示","请选择需要确认的订单");return}var b=new Array();$.each(c,function(d,e){b.push(e.orderid)});$.messager.confirm("提示","是否确认这些订单?",function(d){if(!d){return}$.ajax({url:ws_url+"/rest/order/batchupdateorderstatus?token="+gtoken,contentType:"application/json;charset=UTF-8",type:"post",datatype:"json",data:JSON.stringify(b),cache:false,success:function(e){console.log(e.status);console.log(e.message);if(e.status=="success"){$.messager.alert("提示","确认成功！","info",function(){$("#ordergrid").datagrid("clearSelections");$("#ordergrid").datagrid("reload")})}else{if(e.status=="failure"){$.messager.alert("提示","确认失败！","error",function(){$("#ordergrid").datagrid("clearSelections");$("#ordergrid").datagrid("reload")})}}},error:function(e){console.log(e);$("#ordergrid").datagrid("clearSelections");$.messager.alert("错误","确认失败！","error")}})})}},"-",{id:"btnComplete",text:"完成",disabled:false,iconCls:"icon-save",handler:function(){var c=$("#ordergrid").datagrid("getSelections");if(!c||c.length==0){$.messager.alert("提示","请选择需要确认完成的订单");return}var b=new Array();$.each(c,function(d,e){b.push(e.orderid)});$.messager.confirm("提示","是否确认完成这些订单?",function(d){if(!d){return}$.ajax({url:ws_url+"/rest/order/batchcompleteorderStatus?token="+gtoken,contentType:"application/json;charset=UTF-8",type:"post",datatype:"json",data:JSON.stringify(b),cache:false,success:function(e){console.log(e.status);console.log(e.message);if(e.status=="success"){$.messager.alert("提示","确认成功！","info",function(){$("#ordergrid").datagrid("clearSelections");$("#ordergrid").datagrid("reload")})}else{if(e.status=="failure"){$.messager.alert("提示","确认失败！","error",function(){$("#ordergrid").datagrid("clearSelections");$("#ordergrid").datagrid("reload")})}}},error:function(e){console.log(e);$("#ordergrid").datagrid("clearSelections");$.messager.alert("错误","确认失败！","error")}})})}},"-",{id:"btnSearch",text:"查询",disabled:false,iconCls:"icon-search",handler:function(){alert("功能未开放,请耐心等待!!!")}},"-"],idField:"orderid",frozenColumns:[[{field:"orderid",checkbox:true}]],columns:[[{field:"username",title:"姓名",width:80,align:"center"},{field:"iphone",title:"电话",width:80,align:"center"},{field:"address",title:"地址",width:80,align:"center"},{field:"num",title:"数量(桶)",width:80,align:"center"},{field:"orgname",title:"单位名称",width:80,align:"center"},{field:"orgstatus",title:"订单状态",width:80,align:"center",formatter:function(b,c){switch(b){case"1":return'<span style="color:red;">提交</span>';case"2":return'<span style="color:blue;">分配</span>';
    case"3":return'<span style="color:blueviolet;">确认</span>';case"4":return'<span style="color:green;">完成</span>'}}},{field:"realname",title:"收运人员姓名",width:80,align:"center"},{field:"phone",title:"收运人员电话",width:80,align:"center"},{field:"createdDt",title:"创建时间",width:100,align:"center"},{field:"updatedDt",title:"更新时间",width:100,align:"center",}]],pagination:true,rownumbers:true});function a(g,f,c){console.log(g);var b=g.page-1;var d=g.rows;var e=g.page==1?0:g.rows*(g.page-1);var h=g.rows*g.page;$.ajax({url:ws_url+"/rest/order/findlist?token="+gtoken,type:"post",data:"filterscount=0&groupscount=0&pagenum="+b+"&pagesize="+d+"&recordstartindex="+e+"&recordendindex="+h+"&roleId="+groleid+"&phone="+gphone+"&iphone="+gphone+"",contentType:"application/json;charset=UTF-8",success:function(i){console.log(i);$("#ordergrid").datagrid("clearSelections");f(i)},error:function(i){console.log(i);c(i.responseText)}})}}function initcombobox(){$("#workerlist").combobox({url:ws_url+"/rest/user/findAllTransporter?token="+gtoken,method:"get",valueField:"userId",textField:"realname",icons:[{iconCls:"icon-reload",handler:function(){$("#workerlist").combobox({reload:ws_url+"/rest/user/findAllTransporter?token="+gtoken})}}]})}function Accesscontrol(){switch(groleid){case 9:$("#btnSave").linkbutton("disable");$("#btnAllocating").linkbutton("disable");$("#btnDelete").linkbutton("disable");$("#btnSearch").linkbutton("disable");$("#btnComplete").linkbutton("disable");break;case 10:$("#btnAllocating").linkbutton("disable");$("#btnDelete").linkbutton("disable");$("#btnSearch").linkbutton("disable");$("#btnConfirm").linkbutton("disable");$("#btnComplete").linkbutton("disable");break;case 15:$("#btnSave").linkbutton("disable");$("#btnSearch").linkbutton("disable");$("#btnConfirm").linkbutton("disable");$("#btnComplete").linkbutton("disable");break;case 26:$("#btnSave").linkbutton("disable");$("#btnAllocating").linkbutton("disable");$("#btnDelete").linkbutton("disable");$("#btnSearch").linkbutton("disable");$("#btnConfirm").linkbutton("disable");break}};