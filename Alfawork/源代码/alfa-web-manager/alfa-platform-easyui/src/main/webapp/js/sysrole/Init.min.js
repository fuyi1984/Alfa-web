$(function(){gtoken=ReadCookie("token");if(gtoken!=""){setCurrentUser();$("#roleadd").window("close");$("#roleupdate").window("close");$("#rolesearch").window("close");initdatagrid()}else{window.location.href=platform_url+"/pages/home/login.html"}});function initdatagrid(){$("#rolegrid").datagrid({title:"角色管理 ",singleSelect:false,iconCls:"icon-save",collapsible:true,nowrap:false,striped:true,loader:a,sortName:"createdDt",sortOrder:"desc",remoteSort:true,fitColumns:true,fit:true,toolbar:["-",{id:"btnSave",text:"添加",iconCls:"icon-add",handler:function(){$("#roleadd").window("open")}},"-",{id:"btnUpdate",text:"修改",iconCls:"icon-save",handler:function(){var b=$("#rolegrid").datagrid("getSelections");if(!b||b.length==0){$.messager.alert("提示","请选择要修改的数据");return}else{if(b.length>1){$.messager.alert("提示","请选择一条数据");$("#rolegrid").datagrid("clearSelections");return}else{$("#form2").form("load",{roleId_update:b[0].roleId,role_name_update:b[0].role_name,menuitem_update:b[0].menuitem,roleDesc_update:b[0].roleDesc});$("#roleupdate").window("open")}}}},"-",{id:"btnDelete",text:"删除",disabled:false,iconCls:"icon-cut",handler:function(){var d=$("#rolegrid").datagrid("getSelections");if(!d||d.length==0){$.messager.alert("提示","请选择要删除的数据");return}for(var c=0;c<d.length;c++){if(d[c].roleId==groleid){$.messager.alert("提示","不能删除当前角色!");$("#rolegrid").datagrid("clearSelections");return}if(d[c].roleId==15||d[c].roleId==9||d[c].roleId==10){$.messager.alert("提示","不能删除此角色!");$("#rolegrid").datagrid("clearSelections");return}}var b=new Array();$.each(d,function(e,f){b.push(f.roleId)});$.messager.confirm("提示","是否删除这些数据?",function(e){if(!e){return}$.ajax({cache:false,datatype:"json",contentType:"application/json;charset=UTF-8",type:"POST",url:ws_url+"/rest/roles/batchdeleterole?token="+gtoken,data:JSON.stringify(b),success:function(f){if(f.status=="success"){$.messager.alert("提示","删除成功！","info",function(){$("#rolegrid").datagrid("clearSelections");$("#rolegrid").datagrid("reload")})}else{$.messager.alert("错误","删除失败！","error",function(){$("#rolegrid").datagrid("clearSelections");$("#rolegrid").datagrid("reload")})}},error:function(f){console.log(f);$("#rolegrid").datagrid("clearSelections");$.messager.alert("错误","删除失败！","error")}})})}},"-",{id:"btnSearch",text:"查询",disabled:false,iconCls:"icon-search",handler:function(){$("#rolesearch").window("open")}},"-"],idField:"roleId",frozenColumns:[[{field:"roleId",checkbox:true}]],columns:[[{field:"role_name",title:"角色名称",width:80,align:"center"},{field:"menuitem",title:" 菜单路径",width:80,align:"center"},{field:"roleDesc",title:" 角色描述",width:80,align:"center"},{field:"createdBy",title:"创建人",width:80,align:"center"},{field:"createdDt",title:"创建时间",width:100,align:"center"},{field:"updatedBy",title:"更新人",width:80,align:"center"},{field:"updatedDt",title:"更新时间",width:100,align:"center",}]],pagination:true,rownumbers:true});function a(g,f,c){console.log(g);var b=g.page-1;var d=g.rows;var e=g.page==1?0:g.rows*(g.page-1);var h=g.rows*g.page;$.ajax({url:ws_url+"/rest/roles/findlist?token="+gtoken,type:"post",data:"filterscount=0&groupscount=0&pagenum="+b+"&pagesize="+d+"&recordstartindex="+e+"&recordendindex="+h+"&roleName="+$("#role_name_search").val()+"",contentType:"application/json;charset=UTF-8",success:function(i){console.log(i);$("#rolegrid").datagrid("clearSelections");$("#form3").form("clear");f(i)},error:function(i){console.log(i);c(i.responseText)}})}};