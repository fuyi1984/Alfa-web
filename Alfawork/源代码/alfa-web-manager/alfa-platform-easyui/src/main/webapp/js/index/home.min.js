$(function(){gtoken=ReadCookie("token");if(gtoken!=""){setCurrentUser();InitServerInfo();$("#welcome").html("欢迎 "+grealname+" "+$("#welcome").html());InitLeftMenu();tabClose();tabCloseEven();$("#tabs").tabs({onSelect:function(d){var a=$("#tabs").tabs("getTab",d);var b=$(a.panel("options").content);var c=b.attr("src");if(c){$("#tabs").tabs("update",{tab:a,options:{content:createFrame(c)}})}}})}else{window.location.href=platform_url+"/pages/home/login.html"}});function InitServerInfo(){$.ajax({url:ws_url+"/rest/server/getsysteminfo?token="+gtoken,type:"get",contentType:"application/json;charset=UTF-8",async:true,success:function(a){console.log(a);if(typeof a!="undefined"&&null!=a){$("#os_name").html(a.os_name);$("#os_arch").html(a.os_arch);$("#os_version").html(a.os_version);$("#os_date").html(a.os_date);$("#os_cpus").html(a.os_cpus);$("#os_user_dir").html(a.os_user_dir);$("#java_version").html(a.java_version);$("#java_io_tmpdir").html(a.java_io_tmpdir);$("#sun_desktop").html(a.sun_desktop);$("#server_context").html(a.server_context);$("#server_name").html(a.server_name);$("#server_port").html(a.server_port);$("#server_addr").html(a.server_addr);$("#server_protocol").html(a.server_protocol)}},error:function(a){console.log(a)}})}function InitData(){if(grealname!=""){account=ReadCookie("realname")}alert(account);$("#welcome").html("欢迎 "+grealname+" "+$("#welcome").html());if(ReadCookie("menuitem")!=""){menus=ReadCookie("menuitem")}}function showChangePasswordWin(){$("#iptOldPassword").val("");$("#winPassword").window("open")}function logoutUser(){$.post(ws_url+"/rest/user/logout?token="+gtoken,function(a){SetCookie("token","");window.location.href=platform_url+"/pages/home/login.html"})}function logout(){$.messager.confirm("提示","您确认要注消当前登录用户吗？",function(a){if(a){logoutUser()}})}function add(f){var c=$(f).children(".nav").text();var a=$(f).attr("rel");var d=$(f).attr("ref");var b=getIcon(d);addTab(c,a,b);$(".easyui-accordion li div").removeClass("selected")}function changePassword(){var b=$("#iptOldPassword").val();if(b==""){$.messager.alert("提示","请输入旧密码！");return}var a=$("#iptPassword").val();if(a==""){$.messager.alert("提示","请输入新密码！");return}var c=$("#iptNewPassword").val();if(c==""){$.messager.alert("提示","请确认密码！");return}if(c!=a){$.messager.alert("提示","两次密码不一致，请重新输入！");return}var d={userId:guserid,password:a,oldPassword:b};console.log(d);$.ajax({type:"post",url:ws_url+"/rest/user/modifyPassword?token="+gtoken,contentType:"application/json;charset=UTF-8",data:JSON.stringify(d),async:false,success:function(e){console.log(e);if(e.status=="success"){$.messager.alert("提示","修改成功！","info",function(){$("#winPassword").window("close");$("#iptOldPassword").val("");$("#iptPassword").val("");$("#iptNewPassword").val("");window.location.href=platform_url+"/pages/home/login.html"})}else{$.messager.alert("提示","密码错误，请重新输入！","info")}},error:function(e){console.log(e);$.messager.alert("错误","修改失败！","error")}})}var _menus={};function InitLeftMenu(){$("#nav").accordion({animate:false});$.get(platform_url+gmenuitem,function(c){_menus=c;$.each(c,function(d,f){var e="";e+="<ul>";$.each(f.MenuInfos,function(g,h){e+='<li><div><a ref="'+h.MenuId+'" href="#" rel="'+h.Url+'"  onclick="add(this)" >'+'<span class="icon '+h.Icon+'" >&nbsp;</span><span class="nav">'+h.MenuNames+"</span></a></div></li> "});e+="</ul>";$("#nav").accordion("add",{title:f.MenuName,content:e,iconCls:"icon "+f.Icon})})});var a=$("#nav").accordion("panels");var b=a[0].panel("options").title;$("#nav").accordion("select",b)}function getIcon(b){var a="icon ";$.each(_menus,function(c,d){$.each(d.MenuInfos,function(e,f){if(f.MenuId==b){a+=f.Icon}})});return a}function addTab(b,a,c){if(!$("#tabs").tabs("exists",b)){$("#tabs").tabs("add",{title:b,content:createFrame(a),closable:true,icon:c})}else{$("#tabs").tabs("select",b);$("#mm-tabupdate").click()}tabClose()}function createFrame(a){var b='<iframe scrolling="auto" frameborder="0"  src="'+a+'" style="width:100%;height:100%;"></iframe>';return b}function tabClose(){$(".tabs-inner").dblclick(function(){var a=$(this).children(".tabs-closable").text();$("#tabs").tabs("close",a)});$(".tabs-inner").bind("contextmenu",function(b){$("#mm").menu("show",{left:b.pageX,top:b.pageY});var a=$(this).children(".tabs-closable").text();$("#mm").data("currtab",a);$("#tabs").tabs("select",a);return false})}function tabCloseEven(){$("#mm-tabupdate").click(function(){var a=$("#tabs").tabs("getSelected");var b=$(a.panel("options").content).attr("src");$("#tabs").tabs("update",{tab:a,options:{content:createFrame(b)}})});$("#mm-tabclose").click(function(){var a=$("#mm").data("currtab");$("#tabs").tabs("close",a)});$("#mm-tabcloseall").click(function(){$(".tabs-inner span").each(function(b,c){var a=$(c).text();$("#tabs").tabs("close",a)})});$("#mm-tabcloseother").click(function(){$("#mm-tabcloseright").click();$("#mm-tabcloseleft").click()});$("#mm-tabcloseright").click(function(){var a=$(".tabs-selected").nextAll();if(a.length==0){alert("后边没有啦~~");
    return false}a.each(function(c,d){var b=$("a:eq(0) span",$(d)).text();$("#tabs").tabs("close",b)});return false});$("#mm-tabcloseleft").click(function(){var a=$(".tabs-selected").prevAll();if(a.length==0){alert("到头了，前边没有啦~~");return false}a.each(function(c,d){var b=$("a:eq(0) span",$(d)).text();$("#tabs").tabs("close",b)});return false});$("#mm-exit").click(function(){$("#mm").menu("hide")})}function msgShow(b,c,a){$.messager.alert(b,c,a)};